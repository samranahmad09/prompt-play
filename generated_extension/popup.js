'use strict';(function(){const els={toggle:document.getElementById('toggle'),statusDot:document.getElementById('statusDot'),statusText:document.getElementById('statusText'),sessionCount:document.getElementById('sessionCount'),totalCount:document.getElementById('totalCount'),lastUpdated:document.getElementById('lastUpdated'),sourceSelect:document.getElementById('sourceSelect'),updateBtn:document.getElementById('updateBtn'),whitelistBtn:document.getElementById('whitelistBtn'),resetBtn:document.getElementById('resetBtn'),viewRulesBtn:document.getElementById('viewRulesBtn')};function setEnabledUI(on){els.toggle.checked=!!on;els.statusDot.classList.toggle('on',on);els.statusDot.classList.toggle('off',!on);els.statusText.textContent=on?'Protection: ON':'Protection: OFF'}function fmtTime(ts){if(!ts) return '—';const d=new Date(ts);return d.toLocaleDateString()+', '+d.toLocaleTimeString()}function refresh(){chrome.runtime.sendMessage({type:'getState'},(res)=>{if(!res) return;setEnabledUI(res.enabled);els.sessionCount.textContent=String(res.blockedSession||0);els.totalCount.textContent=String(res.blockedTotal||0);els.lastUpdated.textContent=fmtTime(res.lastUpdate)})}els.toggle.addEventListener('change',()=>{chrome.runtime.sendMessage({type:'toggleEnabled',enabled:els.toggle.checked},refresh)});els.updateBtn.addEventListener('click',()=>{const source=els.sourceSelect.value;els.updateBtn.disabled=true;els.updateBtn.textContent='Updating…';chrome.runtime.sendMessage({type:'updateList',source},(ok)=>{els.updateBtn.disabled=false;els.updateBtn.textContent='Update List';refresh()})});els.resetBtn.addEventListener('click',()=>{chrome.runtime.sendMessage({type:'resetCounters'},refresh)});els.whitelistBtn.addEventListener('click',async()=>{const [tab]=await chrome.tabs.query({active:true,currentWindow:true});if(!tab||!tab.url){return}try{const u=new URL(tab.url);chrome.runtime.sendMessage({type:'whitelistDomain',domain:u.hostname},(ok)=>refresh())}catch(_){}});els.viewRulesBtn.addEventListener('click',()=>{chrome.runtime.sendMessage({type:'getRuleStats'},(res)=>{if(!res) return;alert(`Static rules: ${res.staticCount}\nDynamic rules: ${res.dynamicCount}`)})});chrome.runtime.onMessage.addListener((msg)=>{if(msg&&msg.type==='countsUpdated'){refresh()}});document.addEventListener('DOMContentLoaded',refresh);refresh();})();